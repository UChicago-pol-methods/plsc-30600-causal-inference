<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-01-11">

<title>PLSC 30600 Lab 2: Analayzing Experiments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="lab2_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab2_files/libs/quarto-html/quarto.js"></script>
<script src="lab2_files/libs/quarto-html/popper.min.js"></script>
<script src="lab2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab2_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lab2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
</head><body class="fullcontent">\usepackage{amsmath}
\usepackage{tikz}
\usepackage{amssymb}

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>





<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">PLSC 30600 Lab 2: Analayzing Experiments</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 11, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="analyzing-an-experiment-madsen-et.-al.-2021" class="level1">
<h1>Analyzing an experiment: Madsen et. al.&nbsp;(2021)</h1>
<p>This lab will have you analyze and present results from an experiment conducted by <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3681988">Madsen, Mayoral, Strezhnev and Voeten (2021)</a> examining attitudes towards international courts among voters in European countries. The experiment presented respondents with a vignette about a hypothetical court case in a European country that was then heard by a European court (the vignette was ambiguous, but one could imagine either the European Court of Justice or the European Court of Human Rights). The study manipulated two treatments: the outcome of the case and whether or not the European court overruled the domestic court. Three outcomes were observed: whether respondents agreed with the decision, whether they thought the decision should be implemented, and whether they supported the continued authority of European courts over domestic courts. The goal was to evaluate two competing hypotheses of what drives populist opposition to international courts: do they oppose courts because of a concern over national sovereignty (and so would support a domestic court making the same decision) or because of the content of the decisions (e.g.&nbsp;right-wing populists opposing pro-immigration policies). In other words, do controversial judgments get more support if the decision comes from a domestic court rather than from a European one. The experiment allowed the researchers to vary these attributes independently of one another in a hypothetical scenario.</p>
<p>The paper fielded multiple vignettes but here we’ll focus on the immigration vignette that was fielded in all five countries in the experiment: Denmark, UK, France, Spain and Poland. In the vignette, respondents were asked to consider a case where the government of their home country was considering deporting a foreigner who was convicted of a crime. The foreigner challenged the deportation in a UK court on the grounds that deportation violated his human rights. Two factors were randomly varied: whether the domestic court ruled in favor of the foreigner or in favor of the government and then whether the European court overruled or agreed with the domestic court. This was therefore a 2x2 “factorial” design with four unique treatment combinations. The UK vignette, for example, stated:</p>
<blockquote class="blockquote">
<p>Suppose that United Kingdom (UK) authorities decided to deport a foreigner who has been convicted of a crime. The foreigner appealed at a UK court that the decision to deport him violated his human rights. The UK court found that the authorities [CAN/CANNOT] deport the foreigner. The question was then brought before a European court, which [AGREED WITH/DISAGREED WITH] the UK court. The final decision is that the foreigner should [REMAIN IN THE UK/BE DEPORTED].</p>
</blockquote>
<p>We’ll estimate the effects of whether the foreigner was deported vs.&nbsp;not deported (“outcome treatment”) and the effect of whether the European court deferred to or overruled the domestic court (“deferrence treatment”).</p>
<p>Respondents were then asked 3 questions:</p>
<ol type="1">
<li>Do you agree or disagree with the final decision?</li>
<li>Do you agree or disagree that the final decision should be implemented?</li>
<li>Do you agree or disagree that the country should continue to accept the authority of European courts?</li>
</ol>
<p>All responses were on a 6-level scale (strongly disagree to strongly agree). In the pre-registration the analysis was to be conducted on the dichotomized “agree”/“disagree” outcome, so we’ll focus on estimating effects on that indicator, though we’ll also look at how to visualize treatment effects with multi-level or continuous outcomes. In practice, pre-registered “scales” combining multiple outcomes are increasingly common in recent experiments as they can be much less noisy than individual questions. Pre-registration avoids the risk of p-hacking and multiple testing in choosing how to create that scale.</p>
<p>Below is the code to read in the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Read in dataset</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../../data/final_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The analysis pre-registered four covariates that would be used to create strata for covariate adjustment: Age, Gender, Education and Country. For some experiments (the smaller ones run in only two countries), strata omitting age were required because they were otherwise too small and did not contain enough treated or control units.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Make the strata for covariate adjustment</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Four vars: Age, Gender, Education, Country</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Age - bin into categories</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ageBin =</span> <span class="fu">case_when</span>(QQuotas2 <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> QQuotas2 <span class="sc">&lt;=</span> <span class="dv">34</span> <span class="sc">~</span> <span class="st">"18-34"</span>, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                                           QQuotas2 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> QQuotas2 <span class="sc">&lt;=</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">"35-50"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                                           QQuotas2 <span class="sc">&gt;=</span> <span class="dv">51</span> <span class="sc">~</span><span class="st">"51+"</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>age <span class="ot">&lt;-</span> data<span class="sc">$</span>QQuotas2</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Gender - just take the response directly</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>gender <span class="ot">&lt;-</span> data<span class="sc">$</span>QQuotas1</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Level of education - bin to college/non-college</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">college =</span> <span class="fu">case_when</span>(QQuotas3 <span class="sc">==</span> <span class="st">"ISCED 0:  Early childhood education (‘less than primary’ )"</span> <span class="sc">~</span> <span class="st">"Non-College"</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                                              QQuotas3 <span class="sc">==</span> <span class="st">"ISCED 1: Primary education"</span> <span class="sc">~</span> <span class="st">"Non-College"</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                                              QQuotas3 <span class="sc">==</span> <span class="st">"ISCED 2: Lower secondary education"</span> <span class="sc">~</span> <span class="st">"Non-College"</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                                              QQuotas3 <span class="sc">==</span> <span class="st">"ISCED 3: Upper secondary education"</span> <span class="sc">~</span> <span class="st">"Non-College"</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                                              QQuotas3 <span class="sc">==</span> <span class="st">"ISCED 4: </span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="st">                                                Post-secondary non-tertiary education (NOT a University degree)"</span> <span class="sc">~</span> <span class="st">"Non-College"</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                                              QQuotas3 <span class="sc">==</span> <span class="st">"ISCED 5: Short-cycle tertiary education"</span> <span class="sc">~</span> <span class="st">"College"</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                                              QQuotas3 <span class="sc">==</span> <span class="st">"ISCED 6: Bachelor’s or equivalent level"</span> <span class="sc">~</span> <span class="st">"College"</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                                              QQuotas3 <span class="sc">==</span> <span class="st">"ISCED 7: Master’s or equivalent level"</span> <span class="sc">~</span> <span class="st">"College"</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>                                              QQuotas3 <span class="sc">==</span> <span class="st">"ISCED 8: Doctoral or equivalent level"</span> <span class="sc">~</span> <span class="st">"College"</span>))</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate full-sample stratum bins</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>stratum <span class="ot">&lt;-</span> <span class="fu">paste</span>(data<span class="sc">$</span>country, data<span class="sc">$</span>gender, data<span class="sc">$</span>college, data<span class="sc">$</span>ageBin, <span class="at">sep=</span><span class="st">"|"</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate stratum without age because bins are too small</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>stratum_noage <span class="ot">&lt;-</span> <span class="fu">paste</span>(data<span class="sc">$</span>country, data<span class="sc">$</span>gender, data<span class="sc">$</span>college, <span class="at">sep=</span><span class="st">"|"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We did a bunch of pre-processing of the raw survey responses from Qualtrics – mostly just labeling variables and generating the relevant indicators for treatment. You can ignore all of this code - it’s just tedious cleaning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Create binary outcome variables</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>data  <span class="ot">&lt;-</span> data  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D1Agree =</span> <span class="fu">as.integer</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"disagree"</span>, D1, <span class="at">ignore.case=</span>T))) <span class="co"># Final decision</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>data  <span class="ot">&lt;-</span> data  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D2Agree =</span> <span class="fu">as.integer</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"disagree"</span>, D2, <span class="at">ignore.case=</span>T))) <span class="co"># Should implement</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>data  <span class="ot">&lt;-</span> data  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D3Agree =</span> <span class="fu">as.integer</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"disagree"</span>, D3, <span class="at">ignore.case=</span>T))) <span class="co"># Accept authority</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>data  <span class="ot">&lt;-</span> data  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D4Agree =</span> <span class="fu">as.integer</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"disagree"</span>, D4, <span class="at">ignore.case=</span>T))) <span class="co"># Courts shouldn't intervene</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>data  <span class="ot">&lt;-</span> data  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D5Agree =</span> <span class="fu">as.integer</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"disagree"</span>, D5, <span class="at">ignore.case=</span>T))) <span class="co"># Sue in domestic court</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>data  <span class="ot">&lt;-</span> data  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D6Agree =</span> <span class="fu">as.integer</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"disagree"</span>, D6, <span class="at">ignore.case=</span>T))) <span class="co"># Stop letting IOs tell us what to do</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix missing data</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>D1Agree[<span class="fu">is.na</span>(data<span class="sc">$</span>D1)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>D2Agree[<span class="fu">is.na</span>(data<span class="sc">$</span>D2)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>D3Agree[<span class="fu">is.na</span>(data<span class="sc">$</span>D3)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>D4Agree[<span class="fu">is.na</span>(data<span class="sc">$</span>D4)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>D5Agree[<span class="fu">is.na</span>(data<span class="sc">$</span>D5)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>D6Agree[<span class="fu">is.na</span>(data<span class="sc">$</span>D6)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector with labels for each outcome - Used for graph labels</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>Outcomelabels<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Agree with decision"</span>, <span class="st">"Should implement decision"</span>, <span class="st">"Accept authority of European courts"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Courts shouldn't intervene"</span>, <span class="st">"Sue in domestic court"</span>,<span class="st">"Stop letting IOs tell us"</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>Outcomelabelsshort<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Agree"</span>, <span class="st">"Implement"</span>, <span class="st">"Accept authority"</span>,<span class="st">"Intervene"</span>, <span class="st">"Sue domestic"</span>,<span class="st">"Stop IOs"</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>Outcomelabelsprimary<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Agree with decision"</span>, <span class="st">"Should implement decision"</span>, <span class="st">"Accept authority of European courts"</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>Outcomelabelsprimaryshort<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Agree"</span>, <span class="st">"Implement"</span>, <span class="st">"Accept authority"</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>Outcomelabelssecondary<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Courts shouldn't intervene"</span>, <span class="st">"Sue in domestic court"</span>,<span class="st">"Stop letting IOs tell us"</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>Outcomelabelssecondaryshort<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Intervene"</span>, <span class="st">"Sue domestic"</span>,<span class="st">"Stop IOs"</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Continuous outcome variables for robustness checks</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="do">### Continuous agree variable</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D1AgreeC =</span> <span class="fu">case_when</span>(D1 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>                                                                    D1 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>                                                                    D1 <span class="sc">==</span> <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>                                                                    D1 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>                                                                    D1 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>                                                                    D1 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">6</span>))</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D2AgreeC =</span> <span class="fu">case_when</span>(D2 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>                                                                    D2 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>                                                                    D2 <span class="sc">==</span> <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>                                                                    D2 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>                                                                    D2 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>                                                                    D2 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">6</span>))</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D3AgreeC =</span> <span class="fu">case_when</span>(D3 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>                                                                    D3 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>                                                                    D3 <span class="sc">==</span> <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>                                                                    D3 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>                                                                    D3 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>                                                                    D3 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">6</span>))</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D4AgreeC =</span> <span class="fu">case_when</span>(D4 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>                                                                    D4 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>                                                                    D4 <span class="sc">==</span> <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>                                                                    D4 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>                                                                    D4 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>                                                                    D4 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">6</span>))</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D5AgreeC =</span> <span class="fu">case_when</span>(D5 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>                                                                    D5 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>                                                                    D5 <span class="sc">==</span> <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>                                                                    D5 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>                                                                    D5 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>                                                                    D5 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">6</span>))</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D6AgreeC =</span> <span class="fu">case_when</span>(D6 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>                                                                    D6 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>                                                                    D6 <span class="sc">==</span> <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>                                                                    D6 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>                                                                    D6 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>                                                                    D6 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">6</span>))</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Create moderator variables</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">SatLaw =</span> <span class="fu">case_when</span>(QA4 <span class="sc">==</span> <span class="st">"Dissatisfied"</span> <span class="sc">~</span> <span class="dv">0</span>, <span class="co"># Satisfied with the legal system in your country</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    QA4 <span class="sc">==</span> <span class="st">"Very dissatisfied"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    QA4 <span class="sc">==</span> <span class="st">"Very Satisfied"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    QA4 <span class="sc">==</span> <span class="st">"Satisfied"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    QA4 <span class="sc">==</span> <span class="st">"Neither dissatisfied nor satisfied"</span> <span class="sc">~</span> <span class="dv">0</span>),</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">trust =</span> <span class="fu">case_when</span>(QA1 <span class="sc">==</span> <span class="st">"You can't be too careful in dealing with people (1)"</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="co"># Trust</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>                  QA1 <span class="sc">==</span> <span class="st">"(2)"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>                  QA1 <span class="sc">==</span> <span class="st">"(3)"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>                  QA1 <span class="sc">==</span> <span class="st">"(4)"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>                  QA1 <span class="sc">==</span> <span class="st">"(5)"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>                  QA1 <span class="sc">==</span> <span class="st">"(6)"</span> <span class="sc">~</span> <span class="dv">6</span>,</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>                  QA1 <span class="sc">==</span> <span class="st">"Most people can be trusted (7)"</span> <span class="sc">~</span> <span class="dv">7</span>),</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="at">ideology =</span> <span class="fu">case_when</span>(QC1 <span class="sc">==</span> <span class="st">"Extreme Left (0)"</span> <span class="sc">~</span> <span class="dv">0</span>, <span class="co"># Political ideology (numerical)</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>                  QC1 <span class="sc">==</span> <span class="st">"(1)"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>                  QC1 <span class="sc">==</span> <span class="st">"(2)"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>                  QC1 <span class="sc">==</span> <span class="st">"(3)"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>                  QC1 <span class="sc">==</span> <span class="st">"(4)"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>                  QC1 <span class="sc">==</span> <span class="st">"(5)"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>                  QC1 <span class="sc">==</span> <span class="st">"(6)"</span> <span class="sc">~</span> <span class="dv">6</span>,</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>                  QC1 <span class="sc">==</span> <span class="st">"(7)"</span> <span class="sc">~</span> <span class="dv">7</span>,</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>                  QC1 <span class="sc">==</span> <span class="st">"(8)"</span> <span class="sc">~</span> <span class="dv">8</span>,</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>                  QC1 <span class="sc">==</span> <span class="st">"(9)"</span> <span class="sc">~</span> <span class="dv">9</span>,</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>                  QC1 <span class="sc">==</span> <span class="st">"Extreme right (10)"</span> <span class="sc">~</span> <span class="dv">10</span>),</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>        <span class="at">National =</span> <span class="fu">if_else</span>(QC4 <span class="sc">==</span> <span class="st">"British only"</span>, <span class="dv">1</span>,<span class="dv">0</span>), <span class="co"># National attachment (1 = consider themselves (NATION) only)</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>        <span class="at">Refugee =</span> <span class="fu">if_else</span>(QB9 <span class="sc">==</span> <span class="st">"To deny legal status to someone who did not misrepresent their situation (e.g. faces a death threat back home)"</span>, <span class="dv">0</span>,<span class="dv">1</span>), <span class="co"># Refugee attitudes (sympathy w/ applicant)</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sympathy to eviction applicant</span></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>      <span class="at">EvictFair =</span> <span class="fu">if_else</span>(QB10 <span class="sc">==</span> <span class="st">"To evict people who were treated unfairly by a landlord or mortgage company."</span>, <span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">EvictFair2 =</span> <span class="fu">case_when</span>(QB5 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="co"># Eviction/fairness (agreement scale)</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>                        QB5 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>                        QB5 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>                        QB5 <span class="sc">==</span>  <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>                        QB5 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>                        QB5 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span><span class="dv">0</span>),</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">LGBTNotSameRights =</span> <span class="fu">case_when</span>(QB1 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">0</span>, <span class="co"># Sympathy towards LGBT group.</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>                        QB1 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>                        QB1 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>                        QB1 <span class="sc">==</span>  <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>                        QB1 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>                        QB1 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>      <span class="at">LGBTRights =</span> <span class="fu">case_when</span>(QB1 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">6</span>, <span class="co"># LGBT rights</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>                        QB1 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>                        QB1 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>                        QB1 <span class="sc">==</span>  <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>                        QB1 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>                        QB1 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a><span class="at">IslamSymbol =</span> <span class="fu">case_when</span>(QB4 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">0</span>, <span class="co"># Sympathy towards applicant (islam/Quran burning)</span></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>                        QB4 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>                        QB4 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>                        QB4 <span class="sc">==</span>  <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>                        QB4 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>                        QB4 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Immigrants =</span> <span class="fu">case_when</span>(QB3 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="co"># Attitudes towards immmigration</span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>                        QB3 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>                        QB3 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>                        QB3 <span class="sc">==</span>  <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>                        QB3 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>                        QB3 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span> <span class="dv">0</span>),</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>        <span class="at">Aut1 =</span> <span class="fu">case_when</span>(QC2_1 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">0</span>, <span class="co"># Authoritarianism scale - Q1</span></span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>                        QC2_1 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>                        QC2_1 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>                        QC2_1 <span class="sc">==</span>  <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>                        QC2_1 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>                        QC2_1 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span><span class="dv">5</span>),</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>        <span class="at">Aut2 =</span> <span class="fu">case_when</span>(QC2_2 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">5</span>, <span class="co"># Authoritarianism scale - Q2</span></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>                        QC2_2 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>                        QC2_2 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>                        QC2_2 <span class="sc">==</span>  <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>                        QC2_2 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>                        QC2_2 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span><span class="dv">2</span>),</span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>        <span class="at">Aut3 =</span> <span class="fu">case_when</span>(QC2_3 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">5</span>, <span class="co"># Authoritarianism scale - Q3</span></span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>                        QC2_3 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>                        QC2_3 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>                        QC2_3 <span class="sc">==</span>  <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>                        QC2_3 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>                        QC2_3 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span><span class="dv">0</span>),</span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>        <span class="at">Aut4 =</span> <span class="fu">case_when</span>(QC2_4 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">0</span>, <span class="co"># Authoritarianism scale - Q4</span></span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>                        QC2_4 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>                        QC2_4 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>                        QC2_4 <span class="sc">==</span>  <span class="st">"Slightly disagree"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>                        QC2_4 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>                        QC2_4 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span><span class="dv">5</span>),</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>        <span class="at">Autscale=</span>(Aut1<span class="sc">+</span>Aut2<span class="sc">+</span>Aut3<span class="sc">+</span>Aut4)<span class="sc">/</span><span class="dv">20</span>, <span class="co"># Combine the authoritarianism scale questions</span></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>        <span class="at">Nat1 =</span> <span class="fu">case_when</span>(QC2_5 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="co"># Nationalism scale - Q1</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>                        QC2_5 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> .<span class="dv">8</span>,</span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>                        QC2_5 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> .<span class="dv">6</span>,</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>                        QC2_5 <span class="sc">==</span>  <span class="st">"Slightly disagree"</span> <span class="sc">~</span> .<span class="dv">4</span>,</span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>                        QC2_5 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> .<span class="dv">2</span>,</span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>                        QC2_5 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span><span class="dv">0</span>),</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>        <span class="at">Nat2 =</span> <span class="fu">case_when</span>(QC2_6 <span class="sc">==</span> <span class="st">"Strongly agree"</span> <span class="sc">~</span> <span class="dv">1</span>,  <span class="co"># Nationalism scale - Q2</span></span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>                        QC2_6 <span class="sc">==</span> <span class="st">"Agree"</span> <span class="sc">~</span> .<span class="dv">8</span>,</span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>                        QC2_6 <span class="sc">==</span> <span class="st">"Slightly agree"</span> <span class="sc">~</span> .<span class="dv">6</span>,</span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>                        QC2_6 <span class="sc">==</span>  <span class="st">"Slightly disagree"</span> <span class="sc">~</span> .<span class="dv">4</span>,</span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>                        QC2_6 <span class="sc">==</span> <span class="st">"Disagree"</span> <span class="sc">~</span> .<span class="dv">2</span>,</span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>                        QC2_6 <span class="sc">==</span> <span class="st">"Strongly disagree"</span> <span class="sc">~</span><span class="dv">0</span>),</span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>        <span class="at">Nat3 =</span> <span class="fu">case_when</span>(QC3 <span class="sc">==</span> <span class="st">"Very proud"</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="co"># Nationalism scale - Q3</span></span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>                        QC3 <span class="sc">==</span> <span class="st">"Somewhat proud"</span> <span class="sc">~</span> .<span class="dv">75</span>,</span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>                        QC3 <span class="sc">==</span> <span class="st">"Not very proud"</span> <span class="sc">~</span> .<span class="dv">6</span>,</span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>                        QC3 <span class="sc">==</span>  <span class="st">"Not proud at all"</span> <span class="sc">~</span> .<span class="dv">4</span>),</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Natscale =</span> National <span class="sc">+</span> Nat1 <span class="sc">+</span> Nat2 <span class="sc">+</span> Nat3</span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a><span class="co"># Coarsen authoritarianism and nationalism scales</span></span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">aut=</span><span class="fu">if_else</span>(Autscale<span class="sc">&gt;</span>.<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nat=</span><span class="fu">if_else</span>(Natscale<span class="sc">&gt;</span><span class="fl">1.4</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definition of vignette</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Vignette =</span> <span class="fu">case_when</span>(vignette <span class="sc">==</span> <span class="st">"immigration"</span> <span class="sc">~</span> <span class="st">"Deportation"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                                              vignette <span class="sc">==</span> <span class="st">"other"</span><span class="sc">&amp;</span>(country<span class="sc">==</span><span class="st">"uk"</span><span class="sc">|</span>country<span class="sc">==</span><span class="st">"denmark"</span>)<span class="sc">~</span> <span class="st">"Quran burning"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                                             vignette <span class="sc">==</span> <span class="st">"other"</span><span class="sc">&amp;</span>(country<span class="sc">==</span><span class="st">"spain"</span><span class="sc">|</span>country<span class="sc">==</span><span class="st">"france"</span>) <span class="sc">~</span> <span class="st">"Eviction"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                                             vignette <span class="sc">==</span> <span class="st">"other"</span><span class="sc">&amp;</span>(country<span class="sc">==</span><span class="st">"poland"</span>) <span class="sc">~</span> <span class="st">"Pride Parade"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                                             )</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize outcomes </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">caseOutcome =</span> <span class="fu">case_when</span>(outcome <span class="sc">==</span> <span class="st">"can"</span><span class="sc">&amp;</span>judgment<span class="sc">==</span><span class="st">"agree"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                          outcome <span class="sc">==</span> <span class="st">"can"</span><span class="sc">&amp;</span>judgment<span class="sc">==</span><span class="st">"disagree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                          outcome <span class="sc">==</span> <span class="st">"cannot"</span><span class="sc">&amp;</span>judgment<span class="sc">==</span><span class="st">"disagree"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                          outcome <span class="sc">==</span> <span class="st">"cannot"</span><span class="sc">&amp;</span>judgment<span class="sc">==</span><span class="st">"agree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                          outcome <span class="sc">==</span> <span class="st">"can"</span><span class="sc">&amp;</span>judgment<span class="sc">==</span><span class="st">"nocourt"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                          outcome <span class="sc">==</span> <span class="st">"cannot"</span><span class="sc">&amp;</span>judgment<span class="sc">==</span><span class="st">"nocourt"</span> <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">caseOutcome=</span><span class="fu">if_else</span>(Vignette<span class="sc">==</span><span class="st">"Pride Parade"</span>, caseOutcome<span class="sc">*-</span><span class="dv">1</span><span class="sc">+</span><span class="dv">1</span>, caseOutcome)) <span class="do">##Recodes the pride parade outcome</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">caseDefer =</span> <span class="fu">case_when</span>(judgment <span class="sc">==</span> <span class="st">"agree"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                                              judgment <span class="sc">==</span> <span class="st">"disagree"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>))</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Label vignettes by case outcomes</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">VignetteOutcome =</span> <span class="fu">case_when</span>(Vignette <span class="sc">==</span> <span class="st">"Quran burning"</span> <span class="sc">~</span> <span class="st">"Quran burning, no fine"</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                                             Vignette <span class="sc">==</span> <span class="st">"Eviction"</span> <span class="sc">~</span> <span class="st">"Eviction canceled"</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                                             Vignette <span class="sc">==</span> <span class="st">"Pride Parade"</span> <span class="sc">~</span> <span class="st">"Pride parade not banned"</span>,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                                             Vignette <span class="sc">==</span> <span class="st">"Deportation"</span> <span class="sc">~</span> <span class="st">"Deportation prohibited"</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                                             )</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="do">### Six-category treatment</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatmentBlock =</span> <span class="fu">case_when</span>(outcome <span class="sc">==</span> <span class="st">"can"</span><span class="sc">&amp;</span>judgment<span class="sc">==</span><span class="st">"agree"</span> <span class="sc">~</span> <span class="st">"Entitled, Upheld"</span>,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>                            outcome <span class="sc">==</span> <span class="st">"can"</span><span class="sc">&amp;</span>judgment<span class="sc">==</span><span class="st">"disagree"</span> <span class="sc">~</span> <span class="st">"Entitled, Overturned"</span>,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>                            outcome <span class="sc">==</span> <span class="st">"cannot"</span><span class="sc">&amp;</span>judgment<span class="sc">==</span><span class="st">"disagree"</span> <span class="sc">~</span> <span class="st">"Not Entitled, Overturned"</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                            outcome <span class="sc">==</span> <span class="st">"cannot"</span><span class="sc">&amp;</span>judgment<span class="sc">==</span><span class="st">"agree"</span> <span class="sc">~</span> <span class="st">"Not Entitled, Upheld"</span>,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>                            outcome <span class="sc">==</span> <span class="st">"can"</span><span class="sc">&amp;</span>judgment<span class="sc">==</span><span class="st">"nocourt"</span> <span class="sc">~</span> <span class="st">"Entitled, No Court"</span>,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>                            outcome <span class="sc">==</span> <span class="st">"cannot"</span><span class="sc">&amp;</span>judgment<span class="sc">==</span><span class="st">"nocourt"</span> <span class="sc">~</span> <span class="st">"Not Entitled, No Court"</span>))</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="do">### Treatment ordering with numeric labels</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">treatmentLabel =</span> <span class="fu">case_when</span>(treatmentBlock <span class="sc">==</span> <span class="st">"Entitled, Upheld"</span> <span class="sc">~</span> <span class="st">"Applicant loses, EC defers (2)"</span>,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>                                                   treatmentBlock <span class="sc">==</span> <span class="st">"Entitled, Overturned"</span> <span class="sc">~</span> <span class="st">"Applicant wins, EC overturns (3)"</span>,</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>                                                   treatmentBlock <span class="sc">==</span> <span class="st">"Not Entitled, Overturned"</span> <span class="sc">~</span> <span class="st">"Applicant loses, EC overturns (4)"</span>,</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                                                   treatmentBlock <span class="sc">==</span> <span class="st">"Not Entitled, Upheld"</span> <span class="sc">~</span> <span class="st">"Applicant wins, EC defers (1)"</span>,</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>                                                   treatmentBlock <span class="sc">==</span> <span class="st">"Entitled, No Court"</span> <span class="sc">~</span> <span class="st">"Applicant loses, No EC (6)"</span>,</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>                                                   treatmentBlock <span class="sc">==</span> <span class="st">"Not Entitled, No Court"</span> <span class="sc">~</span> <span class="st">"Applicant wins, No EC (5)"</span>))</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize individuals as unsympathetic towards applicant (1 is less sympathetic)</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="co"># This leverages the four sympathy covariates</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sympathy =</span> <span class="fu">case_when</span>(Vignette <span class="sc">==</span> <span class="st">"Deportation"</span> <span class="sc">~</span> Refugee,</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>                                               Vignette <span class="sc">==</span> <span class="st">"Quran burning"</span> <span class="sc">~</span> IslamSymbol,</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>                                               Vignette <span class="sc">==</span> <span class="st">"Eviction"</span> <span class="sc">~</span> EvictFair,</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>                                               Vignette <span class="sc">==</span> <span class="st">"Pride Parade"</span> <span class="sc">~</span> LGBTNotSameRights))</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Country labels with caps to look better in graphs</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>countryLabel <span class="ot">&lt;-</span> data<span class="sc">$</span>country</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>countryLabel[data<span class="sc">$</span>country <span class="sc">==</span> <span class="st">"denmark"</span>] <span class="ot">&lt;-</span> <span class="st">"Denmark"</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>countryLabel[data<span class="sc">$</span>country <span class="sc">==</span> <span class="st">"uk"</span>] <span class="ot">&lt;-</span> <span class="st">"UK"</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>countryLabel[data<span class="sc">$</span>country <span class="sc">==</span> <span class="st">"poland"</span>] <span class="ot">&lt;-</span> <span class="st">"Poland"</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>countryLabel[data<span class="sc">$</span>country <span class="sc">==</span> <span class="st">"france"</span>] <span class="ot">&lt;-</span> <span class="st">"France"</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>countryLabel[data<span class="sc">$</span>country <span class="sc">==</span> <span class="st">"spain"</span>] <span class="ot">&lt;-</span> <span class="st">"Spain"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also wrote a function for the stratified estimator – literally just taking the difference in means in each sub-group and averaging up to get the point and variance estimates for the ATE. Don’t necessarily need to use this function, but can be useful to see the process broken down into parts in the code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stratified regression estimator</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>strat_reg <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data, stratum){</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Raw counts (use this do diagnostics if things go wrong)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  counts <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(stratum) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">N=</span><span class="fu">n</span>())</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># within each level of the data, fit the model in "formula", lm_robust is linear regression with robust standard error</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  stratum_regs <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(stratum) <span class="sc">%&gt;%</span> <span class="fu">group_map</span>(<span class="sc">~</span><span class="fu">lm_robust</span>(<span class="at">formula=</span>formula, <span class="at">data=</span>.))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get sizes of each stratum</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  sample_sizes <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(stratum_regs, <span class="cf">function</span>(x) x<span class="sc">$</span>nobs)) </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#nobs for most recent version of estimatr - if you're having issues, replace nobs with N (this changed at some point in that package's development)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  sample_shares <span class="ot">&lt;-</span> sample_sizes<span class="sc">/</span><span class="fu">sum</span>(sample_sizes)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get point estimates</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  point_est <span class="ot">&lt;-</span> <span class="fu">sapply</span>(stratum_regs, <span class="cf">function</span>(x) x<span class="sc">$</span>coefficients)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.matrix</span>(point_est)<span class="sc">&amp;</span><span class="fu">is.vector</span>(point_est)){</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    point_est <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(point_est))</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check for NAs</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">sum</span>(<span class="fu">apply</span>(point_est, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(counts[<span class="fu">apply</span>(point_est, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x))) <span class="sc">!=</span> <span class="dv">0</span>,])</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Error: NAs in stratified point estimates, coarsen strata to obtain enough units in each treatment condition per stratum"</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  var_est <span class="ot">&lt;-</span> <span class="fu">sapply</span>(stratum_regs, <span class="cf">function</span>(x) <span class="fu">abs</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(x))))</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>   <span class="co"># diagonals must be positive, some numerical issues w/ Variances of 0 (Pr(Y) = 1 or 0)</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.matrix</span>(var_est)<span class="sc">&amp;</span><span class="fu">is.vector</span>(var_est)){</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    var_est <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(var_est))</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check for NAs</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">sum</span>(<span class="fu">apply</span>(var_est, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(counts[<span class="fu">apply</span>(var_est, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x))) <span class="sc">!=</span> <span class="dv">0</span>,])</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Error: NAs in stratified variance estimates, coarsen strata to obtain enough units in each treatment condition per stratum"</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  point_combined <span class="ot">&lt;-</span> <span class="fu">apply</span>(point_est, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">*</span>sample_shares))</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  se_combined <span class="ot">&lt;-</span> <span class="fu">apply</span>(var_est, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">*</span>sample_shares<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fix names for 1-length vectors</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(point_combined) <span class="sc">&lt;</span> <span class="dv">2</span>){</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    char_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"(Mean)"</span>)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    char_names <span class="ot">&lt;-</span> <span class="fu">names</span>(point_combined)</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save the results</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  out_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">term =</span> <span class="fu">as.character</span>(char_names), <span class="at">estimate=</span>point_combined, <span class="at">std.error =</span> se_combined)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  out_results<span class="sc">$</span>statistic <span class="ot">&lt;-</span> out_results<span class="sc">$</span>estimate<span class="sc">/</span>out_results<span class="sc">$</span>std.error</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  out_results<span class="sc">$</span>conf.low <span class="ot">&lt;-</span> out_results<span class="sc">$</span>estimate <span class="sc">-</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span>out_results<span class="sc">$</span>std.error</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  out_results<span class="sc">$</span>conf.high <span class="ot">&lt;-</span> out_results<span class="sc">$</span>estimate <span class="sc">+</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span>out_results<span class="sc">$</span>std.error </span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out_results)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimating-the-ates" class="level1">
<h1>Estimating the ATEs</h1>
<p>Our outcome variables are</p>
<ul>
<li><code>D1Agree</code> (Binary agree/disagree with decision)</li>
<li><code>D2Agree</code> (Binary agree/disagree with implementing the decision)</li>
<li><code>D3Agree</code> (Binary agree/disagree on European courts should have authority)</li>
</ul>
<p>Our two treatments are</p>
<ul>
<li><code>caseOutcome</code> (0 if foreigner deported, 1 if not deported)</li>
<li><code>caseDefer</code> (0 if European court overruled domestic, 1 if European court deferred)</li>
</ul>
<p>We’ll subset the data down to the immigration vignette. One last small thing is that the immigration vignette also had some number of observations assigned to a “no court” treatment that omitted any European court involvement – since the sample size was already large, there was room to include this “placebo” treatment to see if even mentioning a European court affected attitudes. For today we’ll ignore that treatment</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Only the immigration vignette</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>data_immigration <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(vignette <span class="sc">==</span> <span class="st">"immigration"</span><span class="sc">&amp;</span>judgment<span class="sc">!=</span><span class="st">"nocourt"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Any missing responses: a tiny proportion of observations are missing</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(data_immigration<span class="sc">$</span>D1Agree))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(data_immigration<span class="sc">$</span>D2Agree))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(data_immigration<span class="sc">$</span>D3Agree))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Negligible missingness (only about 6 obs!) -- not really a problem to drop them - very likely missing at random</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>data_immigration <span class="ot">&lt;-</span> data_immigration <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(D1Agree)<span class="sc">&amp;!</span><span class="fu">is.na</span>(D2Agree)<span class="sc">&amp;!</span><span class="fu">is.na</span>(D3Agree))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary stats - sample size</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>data_immigration <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(country, caseOutcome, caseDefer) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">N=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
# Groups:   country, caseOutcome [10]
   country caseOutcome caseDefer     N
   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
 1 denmark           0         0   259
 2 denmark           0         1   249
 3 denmark           1         0   256
 4 denmark           1         1   248
 5 france            0         0   255
 6 france            0         1   251
 7 france            1         0   251
 8 france            1         1   253
 9 poland            0         0   252
10 poland            0         1   249
11 poland            1         0   249
12 poland            1         1   255
13 spain             0         0   254
14 spain             0         1   255
15 spain             1         0   257
16 spain             1         1   253
17 uk                0         0   254
18 uk                0         1   255
19 uk                1         0   248
20 uk                1         1   249</code></pre>
</div>
</div>
<p>Let’s estimate the ATE of the case outcome and the deference treatment on support for implementation (D2Agree) (without covariate adjustment)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome treatment (effect of immigrant "remaining" in country)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>ate_outcome <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(D2Agree <span class="sc">~</span> caseOutcome, <span class="at">data=</span>data_immigration)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ate_outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_robust(formula = D2Agree ~ caseOutcome, data = data_immigration)

Standard error type:  HC2 

Coefficients:
            Estimate Std. Error t value  Pr(&gt;|t|) CI Lower CI Upper   DF
(Intercept)  0.84248    0.00724 116.370 0.000e+00   0.8283  0.85667 5050
caseOutcome -0.08702    0.01122  -7.759 1.027e-14  -0.1090 -0.06503 5050

Multiple R-squared:  0.01179 ,  Adjusted R-squared:  0.0116 
F-statistic: 60.21 on 1 and 5050 DF,  p-value: 1.027e-14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Court deference treatment (effect of european court agreeing with domestic)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ate_defer <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(D2Agree <span class="sc">~</span> caseDefer, <span class="at">data=</span>data_immigration)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ate_defer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_robust(formula = D2Agree ~ caseDefer, data = data_immigration)

Standard error type:  HC2 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  CI Lower CI Upper   DF
(Intercept)  0.78777   0.008123  96.984  0.00000 0.7718472  0.80370 5050
caseDefer    0.02272   0.011271   2.016  0.04389 0.0006223  0.04481 5050

Multiple R-squared:  0.0008036 ,    Adjusted R-squared:  0.0006058 
F-statistic: 4.063 on 1 and 5050 DF,  p-value: 0.04389</code></pre>
</div>
</div>
<p>We might be interested in the effect of one treatment holding the other constant. For that, we include both indicators + an interaction (again, still a fully-saturated model, so it’s still just differences in means, but we have 4 means instead of two).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome treatment (effect of immigrant "remaining" in country)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>joint_model <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(D2Agree <span class="sc">~</span> caseOutcome <span class="sc">+</span> caseDefer <span class="sc">+</span> caseOutcome<span class="sc">*</span>caseDefer, <span class="at">data=</span>data_immigration)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(joint_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_robust(formula = D2Agree ~ caseOutcome + caseDefer + caseOutcome * 
    caseDefer, data = data_immigration)

Standard error type:  HC2 

Coefficients:
                      Estimate Std. Error t value  Pr(&gt;|t|)   CI Lower CI Upper
(Intercept)            0.82810    0.01057 78.3102 0.000e+00  0.8073696  0.84883
caseOutcome           -0.08107    0.01618 -5.0107 5.610e-07 -0.1127949 -0.04935
caseDefer              0.02893    0.01446  2.0000 4.556e-02  0.0005721  0.05729
caseOutcome:caseDefer -0.01204    0.02242 -0.5372 5.912e-01 -0.0559982  0.03191
                        DF
(Intercept)           5048
caseOutcome           5048
caseDefer             5048
caseOutcome:caseDefer 5048

Multiple R-squared:  0.01267 ,  Adjusted R-squared:  0.01208 
F-statistic:  22.2 on 3 and 5048 DF,  p-value: 2.816e-14</code></pre>
</div>
</div>
<p>How do we interpret the baseline and interaction terms – what particular effect does the lower-order coefficient on correspond to (and why is it not the ATE)? How do we interpret the interaction term? What do we conclude about whether court deference moderates the effect of the case outcome treatment?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Great trick if you want a different interpretation for the lower order terms - </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># just re-level the thing you're interacting with.</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>joint_model_2 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(D2Agree <span class="sc">~</span> caseOutcome <span class="sc">+</span> <span class="fu">I</span>(<span class="dv">1</span><span class="sc">-</span>caseDefer) <span class="sc">+</span> caseOutcome<span class="sc">*</span><span class="fu">I</span>(<span class="dv">1</span><span class="sc">-</span>caseDefer), <span class="at">data=</span>data_immigration)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(joint_model_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_robust(formula = D2Agree ~ caseOutcome + I(1 - caseDefer) + 
    caseOutcome * I(1 - caseDefer), data = data_immigration)

Standard error type:  HC2 

Coefficients:
                             Estimate Std. Error t value  Pr(&gt;|t|) CI Lower
(Intercept)                   0.85703   0.009869 86.8390 0.000e+00  0.83768
caseOutcome                  -0.09312   0.015520 -5.9998 2.113e-09 -0.12354
I(1 - caseDefer)             -0.02893   0.014465 -2.0000 4.556e-02 -0.05729
caseOutcome:I(1 - caseDefer)  0.01204   0.022421  0.5372 5.912e-01 -0.03191
                               CI Upper   DF
(Intercept)                   0.8763773 5048
caseOutcome                  -0.0626920 5048
I(1 - caseDefer)             -0.0005721 5048
caseOutcome:I(1 - caseDefer)  0.0559982 5048

Multiple R-squared:  0.01267 ,  Adjusted R-squared:  0.01208 
F-statistic:  22.2 on 3 and 5048 DF,  p-value: 2.816e-14</code></pre>
</div>
</div>
<p>What if we were to look for heterogeneity in the effect of remain vs.&nbsp;deport by country?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome treatment (effect of immigrant "remaining" in country)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ate_outcome_country <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(D2Agree <span class="sc">~</span> caseOutcome <span class="sc">+</span> country <span class="sc">+</span> caseOutcome<span class="sc">*</span>country, <span class="at">data=</span>data_immigration)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ate_outcome_country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_robust(formula = D2Agree ~ caseOutcome + country + caseOutcome * 
    country, data = data_immigration)

Standard error type:  HC2 

Coefficients:
                          Estimate Std. Error t value  Pr(&gt;|t|) CI Lower
(Intercept)                0.89961    0.01335  67.403 0.000e+00  0.87344
caseOutcome               -0.15159    0.02351  -6.447 1.247e-10 -0.19769
countryfrance             -0.06166    0.02114  -2.916 3.557e-03 -0.10311
countrypoland             -0.10320    0.02241  -4.604 4.245e-06 -0.14714
countryspain              -0.09607    0.02211  -4.345 1.421e-05 -0.13942
countryuk                 -0.02534    0.01986  -1.276 2.020e-01 -0.06428
caseOutcome:countryfrance -0.03754    0.03570  -1.052 2.931e-01 -0.10754
caseOutcome:countrypoland  0.12106    0.03512   3.447 5.723e-04  0.05220
caseOutcome:countryspain   0.15198    0.03425   4.437 9.326e-06  0.08482
caseOutcome:countryuk      0.08819    0.03284   2.686 7.265e-03  0.02381
                          CI Upper   DF
(Intercept)                0.92577 5042
caseOutcome               -0.10549 5042
countryfrance             -0.02021 5042
countrypoland             -0.05926 5042
countryspain              -0.05272 5042
countryuk                  0.01360 5042
caseOutcome:countryfrance  0.03245 5042
caseOutcome:countrypoland  0.18991 5042
caseOutcome:countryspain   0.21913 5042
caseOutcome:countryuk      0.15257 5042

Multiple R-squared:  0.02727 ,  Adjusted R-squared:  0.02554 
F-statistic: 15.56 on 9 and 5042 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>What’s the interpretation of the lower order coefficient on caseOutcome? Which of the five countries is “left out”? How would we get the effect for Spain?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Easiest trick is to "re-level" the country factor in R</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>data_immigration<span class="sc">$</span>country2 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data_immigration<span class="sc">$</span>country)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>data_immigration<span class="sc">$</span>country2 <span class="ot">&lt;-</span> <span class="fu">relevel</span>(data_immigration<span class="sc">$</span>country2, <span class="st">"spain"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>ate_outcome_country2 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(D2Agree <span class="sc">~</span> caseOutcome <span class="sc">+</span> country2 <span class="sc">+</span> caseOutcome<span class="sc">*</span>country2, <span class="at">data=</span>data_immigration)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ate_outcome_country2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_robust(formula = D2Agree ~ caseOutcome + country2 + caseOutcome * 
    country2, data = data_immigration)

Standard error type:  HC2 

Coefficients:
                              Estimate Std. Error  t value  Pr(&gt;|t|) CI Lower
(Intercept)                  0.8035363    0.01763 45.58201 0.000e+00  0.76898
caseOutcome                  0.0003852    0.02491  0.01547 9.877e-01 -0.04845
country2denmark              0.0960700    0.02211  4.34490 1.421e-05  0.05272
country2france               0.0344083    0.02408  1.42915 1.530e-01 -0.01279
country2poland              -0.0071292    0.02520 -0.28290 7.773e-01 -0.05653
country2uk                   0.0707269    0.02296  3.08047 2.078e-03  0.02572
caseOutcome:country2denmark -0.1519756    0.03425 -4.43677 9.326e-06 -0.21913
caseOutcome:country2france  -0.1895204    0.03664 -5.17279 2.396e-07 -0.26135
caseOutcome:country2poland  -0.0309194    0.03607 -0.85715 3.914e-01 -0.10164
caseOutcome:country2uk      -0.0637833    0.03385 -1.88411 5.961e-02 -0.13015
                             CI Upper   DF
(Intercept)                  0.838096 5042
caseOutcome                  0.049217 5042
country2denmark              0.139417 5042
country2france               0.081608 5042
country2poland               0.042274 5042
country2uk                   0.115738 5042
caseOutcome:country2denmark -0.084824 5042
caseOutcome:country2france  -0.117694 5042
caseOutcome:country2poland   0.039798 5042
caseOutcome:country2uk       0.002584 5042

Multiple R-squared:  0.02727 ,  Adjusted R-squared:  0.02554 
F-statistic: 15.56 on 9 and 5042 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="adjusting-for-covariates" class="level1">
<h1>Adjusting for covariates</h1>
<p>Let’s compare the covariate-adjusted to the non-covariate adjusted estimates. First, using our strata</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Unadjusted</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome treatment (effect of immigrant "remaining" in country)</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>ate_outcome <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(D2Agree <span class="sc">~</span> caseOutcome, <span class="at">data=</span>data_immigration)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ate_outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_robust(formula = D2Agree ~ caseOutcome, data = data_immigration)

Standard error type:  HC2 

Coefficients:
            Estimate Std. Error t value  Pr(&gt;|t|) CI Lower CI Upper   DF
(Intercept)  0.84248    0.00724 116.370 0.000e+00   0.8283  0.85667 5050
caseOutcome -0.08702    0.01122  -7.759 1.027e-14  -0.1090 -0.06503 5050

Multiple R-squared:  0.01179 ,  Adjusted R-squared:  0.0116 
F-statistic: 60.21 on 1 and 5050 DF,  p-value: 1.027e-14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Adjusted</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ate_outcome_adj <span class="ot">&lt;-</span> <span class="fu">strat_reg</span>(D2Agree <span class="sc">~</span> caseOutcome, <span class="at">data=</span>data_immigration, <span class="at">stratum=</span>data_immigration<span class="sc">$</span>stratum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(diag(vcov_fit$Vcov_hat)): NaNs produced</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ate_outcome_adj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   term    estimate   std.error  statistic   conf.low
(Intercept) (Intercept)  0.84063451 0.007304275 115.088020  0.8263184
caseOutcome caseOutcome -0.08408576 0.011207703  -7.502498 -0.1060525
              conf.high
(Intercept)  0.85495062
caseOutcome -0.06211907</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Lin estimator is the same!</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>ate_outcome_lin <span class="ot">&lt;-</span> <span class="fu">lm_lin</span>(D2Agree <span class="sc">~</span> caseOutcome, <span class="at">covariates =</span> <span class="sc">~</span>stratum, <span class="at">data=</span>data_immigration)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(ate_outcome_lin) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"caseOutcome"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         term    estimate std.error statistic      p.value   conf.low
1 caseOutcome -0.08408576 0.0112077 -7.502498 7.399576e-14 -0.1060579
    conf.high   df outcome
1 -0.06211361 4872 D2Agree</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Court deference treatment (effect of european court agreeing with domestic)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>ate_defer <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(D2Agree <span class="sc">~</span> caseDefer, <span class="at">data=</span>data_immigration)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ate_defer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_robust(formula = D2Agree ~ caseDefer, data = data_immigration)

Standard error type:  HC2 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  CI Lower CI Upper   DF
(Intercept)  0.78777   0.008123  96.984  0.00000 0.7718472  0.80370 5050
caseDefer    0.02272   0.011271   2.016  0.04389 0.0006223  0.04481 5050

Multiple R-squared:  0.0008036 ,    Adjusted R-squared:  0.0006058 
F-statistic: 4.063 on 1 and 5050 DF,  p-value: 0.04389</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ate_defer_adj <span class="ot">&lt;-</span> <span class="fu">strat_reg</span>(D2Agree <span class="sc">~</span> caseDefer, <span class="at">data=</span>data_immigration, <span class="at">stratum=</span>data_immigration<span class="sc">$</span>stratum)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ate_defer_adj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   term   estimate   std.error statistic    conf.low  conf.high
(Intercept) (Intercept) 0.78595646 0.008255984 95.198404 0.769775031 0.80213789
caseDefer     caseDefer 0.02563942 0.011370306  2.254946 0.003354033 0.04792481</code></pre>
</div>
</div>
<p>Our strata didn’t really do that much. This is probably because the covariates didn’t really explain the outcome particularly well and at the sample sizes in this experiment (approximately 5k for the immigration study), additional marginal improvements in variance are hard to get without <strong>very</strong> predictive covariates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome treatment (effect of immigrant "remaining" in country)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>ate_outcome <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(D2Agree <span class="sc">~</span> caseDefer, <span class="at">data=</span>data_immigration)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ate_outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_robust(formula = D2Agree ~ caseDefer, data = data_immigration)

Standard error type:  HC2 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  CI Lower CI Upper   DF
(Intercept)  0.78777   0.008123  96.984  0.00000 0.7718472  0.80370 5050
caseDefer    0.02272   0.011271   2.016  0.04389 0.0006223  0.04481 5050

Multiple R-squared:  0.0008036 ,    Adjusted R-squared:  0.0006058 
F-statistic: 4.063 on 1 and 5050 DF,  p-value: 0.04389</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basically same results with an additive model instead of a fully interacted one (strata)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>ate_outcome_adjusted <span class="ot">&lt;-</span> <span class="fu">lm_lin</span>(D2Agree <span class="sc">~</span> caseDefer, </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">covariates =</span> <span class="sc">~</span> age <span class="sc">+</span> college <span class="sc">+</span> country <span class="sc">+</span> gender, <span class="at">data=</span>data_immigration)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ate_outcome_adjusted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_lin(formula = D2Agree ~ caseDefer, covariates = ~age + college + 
    country + gender, data = data_immigration)

Standard error type:  HC2 

Coefficients:
                                 Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                     0.7810266  0.0090517 86.2850 0.000000
caseDefer                       0.0305613  0.0124494  2.4548 0.014136
age_c                          -0.0005204  0.0005773 -0.9015 0.367358
collegeNon-College_c            0.0235250  0.0190525  1.2347 0.216996
countryfrance_c                -0.0374158  0.0319965 -1.1694 0.242321
countrypoland_c                -0.0415791  0.0324957 -1.2795 0.200784
countryspain_c                  0.0176615  0.0306062  0.5771 0.563932
countryuk_c                     0.0505307  0.0302197  1.6721 0.094578
genderMale_c                    0.0212639  0.0182594  1.1645 0.244271
caseDefer:age_c                 0.0022201  0.0007857  2.8257 0.004740
caseDefer:collegeNon-College_c -0.0047776  0.0263756 -0.1811 0.856269
caseDefer:countryfrance_c      -0.1192564  0.0433357 -2.7519 0.005951
caseDefer:countrypoland_c      -0.0274120  0.0431787 -0.6348 0.525562
caseDefer:countryspain_c       -0.0784565  0.0408382 -1.9212 0.054782
caseDefer:countryuk_c          -0.0696368  0.0401146 -1.7359 0.082648
caseDefer:genderMale_c         -0.0277902  0.0251008 -1.1071 0.268295
                                 CI Lower   CI Upper   DF
(Intercept)                     0.7632804  0.7987728 4114
caseDefer                       0.0061537  0.0549689 4114
age_c                          -0.0016522  0.0006113 4114
collegeNon-College_c           -0.0138282  0.0608782 4114
countryfrance_c                -0.1001463  0.0253146 4114
countrypoland_c                -0.1052882  0.0221301 4114
countryspain_c                 -0.0423432  0.0776663 4114
countryuk_c                    -0.0087162  0.1097775 4114
genderMale_c                   -0.0145344  0.0570621 4114
caseDefer:age_c                 0.0006797  0.0037604 4114
caseDefer:collegeNon-College_c -0.0564880  0.0469328 4114
caseDefer:countryfrance_c      -0.2042178 -0.0342950 4114
caseDefer:countrypoland_c      -0.1120656  0.0572417 4114
caseDefer:countryspain_c       -0.1585215  0.0016086 4114
caseDefer:countryuk_c          -0.1482831  0.0090094 4114
caseDefer:genderMale_c         -0.0770013  0.0214208 4114

Multiple R-squared:  0.01654 ,  Adjusted R-squared:  0.01296 
F-statistic: 4.743 on 15 and 4114 DF,  p-value: 3.428e-09</code></pre>
</div>
</div>
</section>
<section id="visualizing-the-results" class="level1">
<h1>Visualizing the results</h1>
<p>Coppock (2020) has an excellent guide, <a href="https://alexandercoppock.com/coppock_2020.pdf">“Visualize as you Randomize”</a> on constructing visualizations from experiments, using the underlying design to guide graphics choices. One principle is that a good visualization should give a sense of both the underlying data and the experimental design. For example, if we wanted to visualize the ATE, we could present estimates for the means of the treated and the control groups – but we might also want to use a plot of the raw observations to give a sense of the sizes of both the treated and the control groups</p>
<p>We’ll first want to get the marginal means from the <code>lm_robust</code> fit (average under control, average under treated). You can do this manually from the components of <code>lm_robust</code> itself – the mean for control is just <span class="math inline">\(\beta_0\)</span>, the mean for treated is <span class="math inline">\(\beta_1 + \beta_0\)</span> and you can calculate the SE for that sum using the variance-covariance matrix. However, this gets tedious with lots of levels and luckily there are packages that will calculate <em>marginal means</em> for you – <code>ggeffects</code> is a good one (and was imported above)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the marginal means and the data</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>ate_outcome <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(D2Agree <span class="sc">~</span> caseOutcome, <span class="at">data=</span>data_immigration)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>ate_margins <span class="ot">&lt;-</span> ggeffects<span class="sc">::</span><span class="fu">ggeffect</span>(ate_outcome, <span class="at">terms =</span> <span class="st">"caseOutcome"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>ate_margins <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(ate_margins)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># First let's plot the raw data -- add a jitter since it's binary, then add the margins</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># And add transparency (alpha) </span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>data_immigration <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>caseOutcome, <span class="at">y=</span>D2Agree)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height=</span>.<span class="dv">1</span>, <span class="at">width=</span>.<span class="dv">1</span>),</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                                                                        <span class="at">shape =</span> <span class="dv">16</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>                                                                        <span class="at">alpha=</span>.<span class="dv">01</span>) <span class="sc">+</span> </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>predicted, <span class="at">ymin=</span>conf.low, <span class="at">ymax=</span>conf.high), <span class="at">data=</span>ate_margins, <span class="at">size=</span>.<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Outcome of the vignette"</span>,<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">25</span>,<span class="fl">1.25</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Deported"</span>, <span class="st">"Remain"</span>)) <span class="sc">+</span> </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Agree with implementation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="384"></p>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare to just plotting marginal means</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>ate_margins <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>predicted, <span class="at">ymin=</span>conf.low, <span class="at">ymax=</span>conf.high), <span class="at">size=</span>.<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Outcome of the vignette"</span>,<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">25</span>,<span class="fl">1.25</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Deported"</span>, <span class="st">"Remain"</span>)) <span class="sc">+</span> </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Agree with implementation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab2_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>We can compare plotting on top of the raw data with just plotting the marginal means – some advantages and disadvantages to both – for example, it’s hard to see the confidence intervals with the x-axis scaled from 0 to 1 since we have very high precision, but we do get a clearer sense of the magnitude of the effect. Zooming in makes it easier to see the CIs but narrows the X-axis.</p>
<p>How about the joint treatment effects? Let’s plot them using faceting</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the marginal means and the data</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>joint_effect <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(D2Agree <span class="sc">~</span> caseOutcome<span class="sc">*</span>caseDefer, <span class="at">data=</span>data_immigration)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>joint_margins <span class="ot">&lt;-</span> ggeffects<span class="sc">::</span><span class="fu">ggeffect</span>(joint_effect, <span class="fu">c</span>(<span class="st">"caseOutcome"</span>,<span class="st">"caseDefer"</span>))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>joint_margins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Predicted values of D2Agree

# caseDefer = 0

caseOutcome | Predicted |       95% CI
--------------------------------------
          0 |      0.83 | [0.81, 0.85]
          1 |      0.75 | [0.72, 0.77]

# caseDefer = 1

caseOutcome | Predicted |       95% CI
--------------------------------------
          0 |      0.86 | [0.84, 0.88]
          1 |      0.76 | [0.74, 0.79]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make into a table</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>joint_margins_tbl <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(joint_margins)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>joint_margins_tbl <span class="ot">&lt;-</span> joint_margins_tbl <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">caseOutcome =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">caseDefer =</span> <span class="fu">as.numeric</span>(group)<span class="sc">-</span><span class="dv">1</span>) <span class="co"># Rename variables</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's make a "labeler"</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>outcome_names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Outcome: Deported"</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Outcome: Remain"</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>defer_names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"European court: Overrules"</span>,</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"European court: Defers"</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Which do we facet on?</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>joint_margins_tbl <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span>caseOutcome, <span class="at">y=</span>predicted, <span class="at">ymin=</span>conf.low, <span class="at">ymax=</span>conf.high), <span class="at">size=</span>.<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>caseDefer, <span class="at">labeller =</span> <span class="fu">as_labeller</span>(defer_names)) <span class="sc">+</span> </span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Outcome of the vignette"</span>,<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">25</span>,<span class="fl">1.25</span>), </span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Deported"</span>, <span class="st">"Remain"</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Agree with implementation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab2_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="480"></p>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>joint_margins_tbl <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span>caseDefer, <span class="at">y=</span>predicted, <span class="at">ymin=</span>conf.low, <span class="at">ymax=</span>conf.high), <span class="at">size=</span>.<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>caseOutcome, <span class="at">labeller =</span> <span class="fu">as_labeller</span>(outcome_names)) <span class="sc">+</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"European court decision"</span>,<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">25</span>,<span class="fl">1.25</span>), </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Overrule"</span>, <span class="st">"Defer"</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Agree with implementation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab2_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Compare the two figures above – they display the same information, but what does each figure focus on? Which conditional ATEs does the first emphasize vs.&nbsp;the second?</p>
</section>
<section id="challenge" class="level1">
<h1>Challenge</h1>
<p>Visualize the ATEs on the 6-point approval scale <code>D2AgreeC</code> instead of the binary indicator – plot the marginal means on top of the raw data (use jitter). What do you find?</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>